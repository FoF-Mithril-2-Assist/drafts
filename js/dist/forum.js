module.exports=function(t){var a={};function e(o){if(a[o])return a[o].exports;var n=a[o]={i:o,l:!1,exports:{}};return t[o].call(n.exports,n,n.exports,e),n.l=!0,n.exports}return e.m=t,e.c=a,e.d=function(t,a,o){e.o(t,a)||Object.defineProperty(t,a,{enumerable:!0,get:o})},e.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},e.t=function(t,a){if(1&a&&(t=e(t)),8&a)return t;if(4&a&&"object"==typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(e.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&a&&"string"!=typeof t)for(var n in t)e.d(o,n,function(a){return t[a]}.bind(null,n));return o},e.n=function(t){var a=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(a,"a",a),a},e.o=function(t,a){return Object.prototype.hasOwnProperty.call(t,a)},e.p="",e(e.s=18)}([function(t,a){t.exports=flarum.core.compat.app},function(t,a){t.exports=flarum.core.compat.Model},function(t,a){t.exports=flarum.core.compat.extend},function(t,a){t.exports=flarum.core.compat["components/DiscussionComposer"]},function(t,a){t.exports=flarum.core.compat["components/Button"]},function(t,a){t.exports=flarum.core.compat["models/User"]},function(t,a){t.exports=flarum.core.compat["utils/mixin"]},function(t,a){t.exports=flarum.core.compat["components/Page"]},function(t,a){t.exports=flarum.core.compat.Component},function(t,a){t.exports=flarum.core.compat["components/LoadingIndicator"]},function(t,a){t.exports=flarum.core.compat["helpers/avatar"]},function(t,a){t.exports=flarum.core.compat["helpers/icon"]},function(t,a){t.exports=flarum.core.compat["helpers/humanTime"]},function(t,a){t.exports=flarum.core.compat["utils/string"]},function(t,a){t.exports=flarum.core.compat["components/HeaderSecondary"]},function(t,a){t.exports=flarum.core.compat["components/NotificationsDropdown"]},function(t,a){t.exports=flarum.core.compat["components/Alert"]},,function(t,a,e){"use strict";e.r(a);var o=e(2),n=e(5),r=e.n(n),i=e(1),s=e.n(i);function p(t,a){t.prototype=Object.create(a.prototype),t.prototype.constructor=t,t.__proto__=a}var c=e(6),f=function(t){function a(){return t.apply(this,arguments)||this}return p(a,t),a}(e.n(c)()(s.a,{user:s.a.hasOne("user"),content:s.a.attribute("content"),title:s.a.attribute("title"),relationships:s.a.attribute("relationships"),updatedAt:s.a.attribute("updatedAt",s.a.transformDate)})),u=e(7),d=e.n(u),l=e(8),h=e.n(l),y=e(9),g=e.n(y),x=e(3),b=e.n(x),v=e(10),N=e.n(v),w=e(11),O=e.n(w),j=e(12),A=e.n(j),C=e(13),_=e(4),P=e.n(_),k=function(t){function a(){return t.apply(this,arguments)||this}p(a,t);var e=a.prototype;return e.init=function(){this.loading=!1},e.config=function(t){t&&$(".draft--delete").click(function(t){t.stopPropagation()})},e.view=function(){var t=this,a=app.cache.drafts||[];return m("div",{className:"NotificationList RequestsList"},m("div",{className:"NotificationList-header"},m("h4",{className:"App-titleControl App-titleControl--text"},app.translator.trans("fof-drafts.forum.dropdown.title"))),m("div",{className:"NotificationList-content"},m("ul",{className:"NotificationGroup-content"},a.length?a.sort(function(t,a){return a.updatedAt()-t.updatedAt()}).map(function(a){return m("li",null,m("a",{onclick:t.showComposer.bind(t,a),className:"Notification draft--item"},N()(a.user()),O()("fas fa-edit",{className:"Notification-icon"}),m("span",{className:"Notification-content"},a.title()),A()(a.updatedAt()),P.a.component({icon:"fas fa-times",style:"float: right; z-index: 20;",className:"Button Button--icon Button--link draft--delete",title:app.translator.trans("fof-drafts.forum.dropdown.button"),onclick:t.deleteDraft.bind(t,a)}),m("div",{className:"Notification-excerpt"},Object(C.truncate)(a.content(),200))))}):this.loading?g.a.component({className:"LoadingIndicator--block"}):m("div",{className:"NotificationList-empty"},app.translator.trans("fof-drafts.forum.dropdown.empty_text")))))},e.deleteDraft=function(t){this.loading=!0,window.confirm(app.translator.trans("fof-drafts.forum.dropdown.alert"))&&(t.delete(),app.cache.drafts.some(function(a,e){a.id()===t.id()&&app.cache.drafts.splice(e,1)}),app.composer.hide(),this.loading=!1)},e.showComposer=function(t){if(!this.loading){var a={originalContent:t.content(),title:t.title(),user:app.session.user,draft:t};Object.keys(t.relationships()).forEach(function(e){t.relationships()[e].data.map(function(a,o){t.relationships()[e].data[o]=app.store.getById(a.type,a.id)}),a[e]=t.relationships()[e].data});var e=new b.a(a);app.composer.load(e),app.composer.show()}},e.load=function(){var t=this;app.cache.drafts||(this.loading=!0,m.redraw(),app.store.find("drafts").then(function(t){delete t.payload,app.cache.drafts=t}).catch(function(){}).then(function(){t.loading=!1,m.redraw()}))},a}(h.a),D=function(t){function a(){return t.apply(this,arguments)||this}p(a,t);var e=a.prototype;return e.init=function(){t.prototype.init.call(this),app.history.push("drafts"),this.list=new k,this.list.load(),this.bodyClass="App--drafts"},e.view=function(){return m("div",{className:"DraftsPage"},this.list.render())},a}(d.a),B=e(0),S=e.n(B),L=e(14),M=e.n(L),I=e(15),T=function(t){function a(){return t.apply(this,arguments)||this}p(a,t),a.initProps=function(a){a.label=a.label||app.translator.trans("fof-drafts.forum.dropdown.tooltip"),a.icon=a.icon||"fas fa-edit",t.initProps.call(this,a)};var e=a.prototype;return e.init=function(){t.prototype.init.call(this),this.list=new k},e.goToRoute=function(){m.route(app.route("drafts"))},e.getUnreadCount=function(){return app.cache.drafts?app.cache.drafts.length:app.session.user.data.relationships.drafts.data.length},e.getNewCount=function(){return app.cache.drafts?app.cache.drafts.length:app.session.user.data.relationships.drafts.data.length},a}(e.n(I).a),R=e(16),z=e.n(R);app.initializers.add("fof-drafts",function(){app.store.models.drafts=f,r.a.prototype.drafts=s.a.hasMany("drafts"),app.routes.drafts={path:"/drafts",component:m(D,null)},Object(o.extend)(b.a.prototype,"headerItems",function(t){var a=this;app.forum.attribute("canSaveDrafts")&&t.add("save-draft",P.a.component({icon:"fas fa-save",className:"Button Button--icon Button--link",style:"margin: 0 10px 2px -10px;",title:app.translator.trans("fof-drafts.forum.composer.title"),onclick:function(){a.draft?(delete a.draft.data.attributes.relationships,a.draft.save(a.data()).then(function(t){app.cache.drafts||(app.cache.drafts=[]),app.cache.drafts.some(function(a,e){if(a.id()===t.id()){var o=new Date;t.data.attributes.updatedAt=o.toString(),app.cache.drafts[e]=t}})})):app.store.createRecord("drafts").save(a.data()).then(function(t){app.cache.drafts?app.cache.drafts.push(t):app.session.user.data.relationships.drafts.data.push(t),m.redraw()}),app.alerts.show(a.successAlert=new z.a({type:"success",children:app.translator.trans("fof-drafts.forum.composer.alert")})),app.composer.hide()}}),20)}),Object(o.extend)(b.a.prototype,"init",function(){var t=this;Object.keys(this.props).forEach(function(a){["originalContent","title","user"].includes(a)?"title"===a&&(t.title=m.prop(t.props.title)):t[a]=t.props[a]})}),Object(o.extend)(M.a.prototype,"items",function(t){S.a.session.user&&(S.a.session.user.data.relationships.drafts&&S.a.session.user.data.relationships.drafts.data.length&&!S.a.cache.drafts||S.a.cache.drafts&&0!==S.a.cache.drafts.length)&&t.add("Drafts",m(T,null),20)})})}]);
//# sourceMappingURL=forum.js.map