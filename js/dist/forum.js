module.exports=function(t){var e={};function o(a){if(e[a])return e[a].exports;var n=e[a]={i:a,l:!1,exports:{}};return t[a].call(n.exports,n,n.exports,o),n.l=!0,n.exports}return o.m=t,o.c=e,o.d=function(t,e,a){o.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:a})},o.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var a=Object.create(null);if(o.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)o.d(a,n,function(e){return t[e]}.bind(null,n));return a},o.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="",o(o.s=18)}([function(t,e){t.exports=flarum.core.compat.app},function(t,e){t.exports=flarum.core.compat.Model},function(t,e){t.exports=flarum.core.compat.extend},function(t,e){t.exports=flarum.core.compat["components/DiscussionComposer"]},function(t,e){t.exports=flarum.core.compat["components/Button"]},function(t,e){t.exports=flarum.core.compat["models/User"]},function(t,e){t.exports=flarum.core.compat["utils/mixin"]},function(t,e){t.exports=flarum.core.compat["components/Page"]},function(t,e){t.exports=flarum.core.compat.Component},function(t,e){t.exports=flarum.core.compat["components/LoadingIndicator"]},function(t,e){t.exports=flarum.core.compat["helpers/avatar"]},function(t,e){t.exports=flarum.core.compat["helpers/icon"]},function(t,e){t.exports=flarum.core.compat["helpers/humanTime"]},function(t,e){t.exports=flarum.core.compat["utils/string"]},function(t,e){t.exports=flarum.core.compat["components/HeaderSecondary"]},function(t,e){t.exports=flarum.core.compat["components/NotificationsDropdown"]},function(t,e){t.exports=flarum.core.compat["components/Alert"]},,function(t,e,o){"use strict";o.r(e);var a=o(2),n=o(5),r=o.n(n),i=o(1),s=o.n(i);function c(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.__proto__=e}var p=o(6),f=function(t){function e(){return t.apply(this,arguments)||this}return c(e,t),e}(o.n(p)()(s.a,{user:s.a.hasOne("user"),content:s.a.attribute("content"),title:s.a.attribute("title"),relationships:s.a.attribute("relationships"),updatedAt:s.a.attribute("updatedAt",s.a.transformDate)})),u=o(7),l=o.n(u),d=o(8),h=o.n(d),y=o(9),g=o.n(y),v=o(3),x=o.n(v),b=o(10),N=o.n(b),w=o(11),O=o.n(w),j=o(12),A=o.n(j),C=o(13),_=o(4),P=o.n(_),k=function(t){function e(){return t.apply(this,arguments)||this}c(e,t);var o=e.prototype;return o.init=function(){this.loading=!1},o.config=function(t){t&&$(".draft--delete").on("click tap",function(t){t.stopPropagation()})},o.view=function(){var t=this,e=app.cache.drafts||[];return m("div",{className:"NotificationList RequestsList"},m("div",{className:"NotificationList-header"},m("h4",{className:"App-titleControl App-titleControl--text"},app.translator.trans("fof-drafts.forum.dropdown.title"))),m("div",{className:"NotificationList-content"},m("ul",{className:"NotificationGroup-content"},e.length?e.sort(function(t,e){return e.updatedAt()-t.updatedAt()}).map(function(e){return m("li",null,m("a",{onclick:t.showComposer.bind(t,e),className:"Notification draft--item"},N()(e.user()),O()("fas fa-edit",{className:"Notification-icon"}),m("span",{className:"Notification-content"},e.title()),A()(e.updatedAt()),P.a.component({icon:"fas fa-times",style:"float: right; z-index: 20;",className:"Button Button--icon Button--link draft--delete",title:app.translator.trans("fof-drafts.forum.dropdown.button"),onclick:t.deleteDraft.bind(t,e)}),m("div",{className:"Notification-excerpt"},Object(C.truncate)(e.content(),200))))}):this.loading?g.a.component({className:"LoadingIndicator--block"}):m("div",{className:"NotificationList-empty"},app.translator.trans("fof-drafts.forum.dropdown.empty_text")))))},o.deleteDraft=function(t){this.loading=!0,window.confirm(app.translator.trans("fof-drafts.forum.dropdown.alert"))&&(t.delete(),app.cache.drafts.some(function(e,o){e.id()===t.id()&&app.cache.drafts.splice(o,1)}),app.composer.hide(),this.loading=!1)},o.showComposer=function(t){if(!this.loading){var e=m.deferred(),o={originalContent:t.content(),title:t.title(),user:app.session.user,draft:t};t.relationships()&&Object.keys(t.relationships()).forEach(function(e){t.relationships()[e].data.map(function(o,a){t.relationships()[e].data[a]=app.store.getById(o.type,o.id)}),o[e]=t.relationships()[e].data});var a=new x.a(o);return app.composer.load(a),app.composer.show(),e.resolve(a),e.promise}},o.load=function(){var t=this;app.cache.drafts||(this.loading=!0,m.redraw(),app.store.find("drafts").then(function(t){delete t.payload,app.cache.drafts=t}).catch(function(){}).then(function(){t.loading=!1,m.redraw()}))},e}(h.a),D=function(t){function e(){return t.apply(this,arguments)||this}c(e,t);var o=e.prototype;return o.init=function(){t.prototype.init.call(this),app.history.push("drafts"),this.list=new k,this.list.load(),this.bodyClass="App--drafts"},o.view=function(){return m("div",{className:"DraftsPage"},this.list.render())},e}(l.a),B=o(0),S=o.n(B),L=o(14),M=o.n(L),I=o(15),T=function(t){function e(){return t.apply(this,arguments)||this}c(e,t),e.initProps=function(e){e.label=e.label||app.translator.trans("fof-drafts.forum.dropdown.tooltip"),e.icon=e.icon||"fas fa-edit",t.initProps.call(this,e)};var o=e.prototype;return o.init=function(){t.prototype.init.call(this),this.list=new k},o.goToRoute=function(){m.route(app.route("drafts"))},o.getUnreadCount=function(){return app.cache.drafts?app.cache.drafts.length:app.session.user.drafts().length},o.getNewCount=function(){return app.cache.drafts?app.cache.drafts.length:app.session.user.drafts().length},e}(o.n(I).a),R=o(16),z=o.n(R);app.initializers.add("fof-drafts",function(){app.store.models.drafts=f,r.a.prototype.drafts=s.a.hasMany("drafts"),app.routes.drafts={path:"/drafts",component:m(D,null)},Object(a.extend)(x.a.prototype,"headerItems",function(t){var e=this;app.forum.attribute("canSaveDrafts")&&t.add("save-draft",P.a.component({icon:"fas fa-save",className:"Button Button--icon Button--link",style:"margin: 0 10px 2px -10px;",title:app.translator.trans("fof-drafts.forum.composer.title"),onclick:function(){e.draft?(delete e.draft.data.attributes.relationships,e.draft.save(e.data()).then(function(t){app.cache.drafts||(app.cache.drafts=[]),app.cache.drafts.some(function(e,o){if(e.id()===t.id()){var a=new Date;t.data.attributes.updatedAt=a.toString(),app.cache.drafts[o]=t}})})):app.store.createRecord("drafts").save(e.data()).then(function(t){app.cache.drafts?app.cache.drafts.push(t):app.session.user.data.relationships.drafts.data.push(t),m.redraw()}),app.alerts.show(e.successAlert=new z.a({type:"success",children:app.translator.trans("fof-drafts.forum.composer.alert")})),app.composer.hide()}}),20)}),Object(a.extend)(x.a.prototype,"init",function(){var t=this;Object.keys(this.props).forEach(function(e){["originalContent","title","user"].includes(e)?"title"===e&&(t.title=m.prop(t.props.title)):t[e]=t.props[e]})}),Object(a.extend)(M.a.prototype,"items",function(t){S.a.session.user&&(S.a.session.user.drafts()&&S.a.session.user.drafts().length&&!S.a.cache.drafts||S.a.cache.drafts&&0!==S.a.cache.drafts.length)&&t.add("Drafts",m(T,null),20)})})}]);
//# sourceMappingURL=forum.js.map