module.exports=function(t){var e={};function a(o){if(e[o])return e[o].exports;var n=e[o]={i:o,l:!1,exports:{}};return t[o].call(n.exports,n,n.exports,a),n.l=!0,n.exports}return a.m=t,a.c=e,a.d=function(t,e,o){a.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:o})},a.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},a.t=function(t,e){if(1&e&&(t=a(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(a.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)a.d(o,n,function(e){return t[e]}.bind(null,n));return o},a.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return a.d(e,"a",e),e},a.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},a.p="",a(a.s=21)}([function(t,e){t.exports=flarum.core.compat.Model},function(t,e){t.exports=flarum.core.compat.extend},function(t,e){t.exports=flarum.core.compat["components/Button"]},function(t,e){t.exports=flarum.core.compat.app},function(t,e){t.exports=flarum.core.compat["components/DiscussionComposer"]},function(t,e){t.exports=flarum.core.compat["components/LoadingIndicator"]},function(t,e){t.exports=flarum.core.compat["models/User"]},function(t,e){t.exports=flarum.core.compat["components/Alert"]},function(t,e){t.exports=flarum.core.compat["components/Composer"]},,function(t,e){t.exports=flarum.core.compat["utils/mixin"]},function(t,e){t.exports=flarum.core.compat["components/Page"]},function(t,e){t.exports=flarum.core.compat.Component},function(t,e){t.exports=flarum.core.compat["helpers/avatar"]},function(t,e){t.exports=flarum.core.compat["helpers/icon"]},function(t,e){t.exports=flarum.core.compat["helpers/humanTime"]},function(t,e){t.exports=flarum.core.compat["utils/string"]},function(t,e){t.exports=flarum.core.compat["components/Modal"]},function(t,e){t.exports=flarum.core.compat["components/HeaderSecondary"]},function(t,e){t.exports=flarum.core.compat["components/NotificationsDropdown"]},,function(t,e,a){"use strict";function o(){return(o=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var a=arguments[e];for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(t[o]=a[o])}return t}).apply(this,arguments)}a.r(e);var n=a(1),r=a(6),s=a.n(r),i=a(0),c=a.n(i);function d(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.__proto__=e}var u=a(10),p=function(t){function e(){return t.apply(this,arguments)||this}return d(e,t),e}(a.n(u)()(c.a,{user:c.a.hasOne("user"),content:c.a.attribute("content"),title:c.a.attribute("title"),scheduledValidationError:c.a.attribute("scheduledValidationError"),relationships:c.a.attribute("relationships"),scheduledFor:c.a.attribute("scheduledFor",c.a.transformDate),updatedAt:c.a.attribute("updatedAt",c.a.transformDate)})),f=a(11),l=a.n(f),h=a(12),v=a.n(h),b=a(5),y=a.n(b),g=a(4),x=a.n(g),N=a(13),w=a.n(N),_=a(14),j=a.n(_),D=a(15),k=a.n(D),S=a(16),C=a(2),F=a.n(C),O=a(7),M=a.n(O),B=a(17),E=a.n(B),P=function(){function t(t){return function(e){return new Promise((function(a,o){var n=document.createElement(t),r="body",s="src";switch(n.onload=function(){a(e)},n.onerror=function(){o(e)},t){case"script":n.async=!0;break;case"link":n.type="text/css",n.rel="stylesheet",s="href",r="head"}n[s]=e,document[r].appendChild(n)}))}}return{css:t("link"),js:t("script"),img:t("img")}}(),A=function(t){function e(){return t.apply(this,arguments)||this}d(e,t);var a=e.prototype;return a.init=function(){t.prototype.init.call(this),this.loading=!1},a.className=function(){return"ScheduleDraftModal"},a.title=function(){return app.translator.trans("fof-drafts.forum.schedule_draft_modal.title")},a.content=function(){return this.loading?m(y.a,null):[this.props.draft.scheduledFor()?m("div",{className:"Modal-alert"},m(M.a,{type:"success",dismissible:!1},app.translator.trans("fof-drafts.forum.schedule_draft_modal.scheduled_text",{datetime:moment(this.props.draft.scheduledFor()).format("LLLL")}))):"",this.props.draft.scheduledValidationError()?m("div",{className:"Modal-alert"},m(M.a,{type:"error",dismissible:!1},app.translator.trans("fof-drafts.forum.schedule_draft_modal.scheduled_error",{error:this.props.draft.scheduledValidationError()}))):"",m("input",{style:"display: none"}),m("div",{className:"Modal-body"},m("div",{className:"Form Form--centered"},m("p",{className:"helpText"},app.translator.trans("fof-drafts.forum.schedule_draft_modal.text")),m("div",{className:"Form-group flatpickr"},m("input",{name:"scheduledFor",className:"FormControl flatpickr-input","data-input":!0,onchange:m.redraw})),m("div",{className:"Form-group"},F.a.component({className:"Button Button--block"+(this.unscheduleMode()?" Button--danger":" Button--primary"),type:"submit",loading:this.loading,children:this.unscheduleMode()?app.translator.trans("fof-drafts.forum.schedule_draft_modal.unschedule_button"):this.rescheduleMode()?app.translator.trans("fof-drafts.forum.schedule_draft_modal.reschedule_button"):app.translator.trans("fof-drafts.forum.schedule_draft_modal.schedule_button")}))))]},a.config=function(t){var e=this;if(!t){var a=app.forum.attribute("baseUrl")+"/assets/extensions/fof-drafts/flatpickr";this.loading=!0,Promise.all("undefined"==typeof flatpickr?[P.js(a+".js"),P.css(a+".css")]:[]).then((function(){e.loading=!1,m.redraw(),e.flatpickr=flatpickr(".flatpickr-input",{enableTime:!0,enableSeconds:!1,minDate:Date.now(),maxDate:new Date(9999,12,31),defaultDate:e.props.draft.scheduledFor()})}))}},a.scheduledFor=function(){return new Date($("input[name=scheduledFor]").val())},a.changed=function(){var t=function(t){return t?t.getTime():null};return t(this.scheduledFor())!==t(this.props.draft.scheduledFor())},a.unscheduleMode=function(){return!this.changed()&&this.props.draft.scheduledFor()},a.rescheduleMode=function(){return this.changed()&&this.props.draft.scheduledFor()},a.onsubmit=function(t){var e=this;t.preventDefault(),this.loading=!0,this.props.draft.save({scheduledFor:this.unscheduleMode()?null:this.scheduledFor(),clearValidationError:!0,scheduledValidationError:""}).then((function(){return e.success=!0})).catch((function(){})).then(this.loaded.bind(this))},e}(E.a),L=function(t){function e(){return t.apply(this,arguments)||this}d(e,t);var a=e.prototype;return a.init=function(){this.loading=!1},a.config=function(t){t&&$(".draft--delete").on("click tap",(function(t){t.stopPropagation()}))},a.view=function(){var t=this,e=app.cache.drafts||[];return m("div",{className:"NotificationList DraftsList"},m("div",{className:"NotificationList-header"},m("h4",{className:"App-titleControl App-titleControl--text"},app.translator.trans("fof-drafts.forum.dropdown.title"))),m("div",{className:"NotificationList-content"},m("ul",{className:"NotificationGroup-content"},e.length?e.sort((function(t,e){return e.updatedAt()-t.updatedAt()})).map((function(e){return m("li",null,m("a",{onclick:t.showComposer.bind(t,e),className:"Notification draft--item"},w()(e.user()),j()("fas fa-edit",{className:"Notification-icon"}),m("span",{className:"Notification-content"},e.title()),k()(e.updatedAt()),F.a.component({icon:"fas fa-times",style:"float: right; z-index: 20;",className:"Button Button--icon Button--link draft--delete",title:app.translator.trans("fof-drafts.forum.dropdown.delete_button"),onclick:t.deleteDraft.bind(t,e)}),app.forum.attribute("canScheduleDrafts")&&app.forum.attribute("drafts.enableScheduledDrafts")?F.a.component({icon:e.scheduledValidationError()?"fas fa-calendar-times":e.scheduledFor()?"fas fa-calendar-check":"fas fa-calendar-plus",style:"float: right; z-index: 20;",className:"Button Button--icon Button--link draft--schedule",title:app.translator.trans("fof-drafts.forum.dropdown.schedule_button"),onclick:function(a){t.scheduleDraft(e),a.stopPropagation()}}):"",m("div",{className:"Notification-excerpt"},Object(S.truncate)(e.content(),200)),e.scheduledValidationError()?m("p",{className:"scheduledValidationError"},e.scheduledValidationError()):""))})):this.loading?y.a.component({className:"LoadingIndicator--block"}):m("div",{className:"NotificationList-empty"},app.translator.trans("fof-drafts.forum.dropdown.empty_text")))))},a.deleteDraft=function(t){this.loading=!0,window.confirm(app.translator.trans("fof-drafts.forum.dropdown.alert"))&&(t.delete(),app.cache.drafts.some((function(e,a){e.id()===t.id()&&app.cache.drafts.splice(a,1)})),app.composer.hide(),this.loading=!1)},a.scheduleDraft=function(t){app.forum.attribute("canScheduleDrafts")&&app.forum.attribute("drafts.enableScheduledDrafts")&&app.modal.show(new A({draft:t}))},a.showComposer=function(t){if(!this.loading){var e=m.deferred(),a={originalContent:t.content(),title:t.title(),user:app.session.user,confirmExit:app.translator.trans("fof-drafts.forum.composer.exit_alert"),draft:t},o=t.relationships();o&&Object.keys(o).forEach((function(t){var e=o[t].data.map((function(t,e){return app.store.getById(t.type,t.id)}));a[t]=e}));var n=new x.a(a);return app.composer.load(n),app.composer.show(),e.resolve(n),e.promise}},a.load=function(){var t=this;app.cache.drafts||(this.loading=!0,m.redraw(),app.store.find("drafts").then((function(t){delete t.payload,app.cache.drafts=t})).catch((function(){})).then((function(){t.loading=!1,m.redraw()})))},e}(v.a),V=function(t){function e(){return t.apply(this,arguments)||this}d(e,t);var a=e.prototype;return a.init=function(){t.prototype.init.call(this),app.history.push("drafts"),this.list=new L,this.list.load(),this.bodyClass="App--drafts"},a.view=function(){return m("div",{className:"DraftsPage"},this.list.render())},e}(l.a),T=a(3),I=a.n(T),z=a(18),U=a.n(z),R=a(19),G=function(t){function e(){return t.apply(this,arguments)||this}d(e,t),e.initProps=function(e){e.label=e.label||app.translator.trans("fof-drafts.forum.dropdown.tooltip"),e.icon=e.icon||"fas fa-edit",t.initProps.call(this,e)};var a=e.prototype;return a.init=function(){t.prototype.init.call(this),this.list=new L},a.goToRoute=function(){m.route(app.route("drafts"))},a.getUnreadCount=function(){return app.cache.drafts?app.cache.drafts.length:app.session.user.draftCount()},a.getNewCount=function(){return app.cache.drafts?app.cache.drafts.length:app.session.user.draftCount()},e}(a.n(R).a),H=a(8),q=a.n(H);app.initializers.add("fof-drafts",(function(){app.store.models.drafts=p,s.a.prototype.drafts=c.a.hasMany("drafts"),s.a.prototype.draftCount=c.a.attribute("draftCount"),app.routes.drafts={path:"/drafts",component:m(V,null)},Object(n.extend)(q.a.prototype,"controlItems",(function(t){var e=this;if(this.component instanceof x.a&&app.forum.attribute("canSaveDrafts")){var a=["Button","Button--icon","Button--link"];this.saving&&a.push("saving"),this.justSaved&&a.push("justSaved"),t.add("save-draft",F.a.component({icon:this.justSaved?"fas fa-check":this.saving?"fas fa-spinner fa-spin":"fas fa-save",className:a.join(" "),itemClassName:"App-backControl",title:app.translator.trans("fof-drafts.forum.composer.title"),disabled:this.saving||this.justSaved,onclick:function(){e.saving=!0;var t=function(){e.saving=!1,e.justSaved=!0,setTimeout((function(){e.justSaved=!1,m.redraw()}),300),m.redraw()};e.component.draft?(delete e.component.draft.data.attributes.relationships,e.component.draft.save(o(e.component.draft.data.attributes,e.component.data())).then((function(e){app.cache.drafts=app.cache.drafts||[],app.cache.drafts.forEach((function(t,a){if(t.id()===e.id()){var o=new Date;e.data.attributes.updatedAt=o.toString(),app.cache.drafts[a]=e}})),t()}))):app.store.createRecord("drafts").save(e.component.data()).then((function(a){app.cache.drafts=app.cache.drafts||[],app.cache.drafts.push(a),e.component.draft=a,t()}))}}),20)}})),Object(n.extend)(q.a.prototype,"init",(function(){app.forum.attribute("canSaveDrafts")&&(new L).load()})),Object(n.extend)(x.a.prototype,"init",(function(){var t=this;Object.keys(this.props).forEach((function(e){["originalContent","title","user"].includes(e)?"title"===e&&(t.title=m.prop(t.props.title)):t[e]=t.props[e]}))})),Object(n.extend)(x.a.prototype,"onsubmit",(function(){var t=this;this.draft&&(this.draft.delete(),app.cache.drafts=app.cache.drafts.filter((function(e){return e.id()!==t.draft.id()})))})),Object(n.extend)(U.a.prototype,"items",(function(t){I.a.session.user&&I.a.forum.attribute("canSaveDrafts")&&t.add("Drafts",m(G,null),20)}))}))}]);
//# sourceMappingURL=forum.js.map